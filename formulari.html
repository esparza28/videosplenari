<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Formulari Ple Municial Gandia</title>
    <meta name="keywords" content="" />
    <meta name="description" content="">
    <meta name="author" content="caca.net">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, shrink-to-fit=no">
    <link rel="shortcut icon" href="" type="image/x-icon" />

    <link id="googleFonts" href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700&display=swap"
        rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
        integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="css/custom.css">

</head>

<body>
    <div class="container">
        <h1 class="text-center p-2">Sessió parlamentaria</h1>
        <form id="myForm" onsubmit='return get()'>
            <div class="row col-sm" id="input_fields_wrap">
                <div class="d-flex">
                    <label class="form-group p-1" for="url">URL youtube: </label>
                    <input class="form-group col col-md-6 m-1" type="text" accept="text/plain" name="url" class="form-control" id="url"
                    placeholder="Url video youtube">
                </div>
                <div>
                    <label class="form-group col" for="url">Fitxer de la sessió: </label>
                    <input class="form-group col m-1" type="file" name="file" class="form-control" id="file">
                </div>

                <label class="form-group col-md-6" for="punt">Punt del dia</label>
                <label class="form-group col-md-6" for="time">Temps</label>

                <div class="form-group row">
                    <input class="form-group col m-1" type="text" name="punt" class="form-control" id="punt0"
                        placeholder="Punt del dia">
                    <input class="form-group col m-1" type="text" name="time" class="form-control" id="time0"
                        placeholder="Temps">
                    <button class="col-1 btn btn-outline-danger p-0 btn-sm" id="remove_field">
                        <i class="fas fa-minus-circle"></i>Eliminar
                    </button>
                </div>
            </div>
            <div class="row justify-content-end">
                <button class="col-1 btn btn-outline-success my-2" id="add_button"><i
                        class="fas fa-plus-circle"></i>Afegir
                </button>
            </div>
            <div class="row">
                <button class="btn btn-outline-primary btn-sm" type="submit">Registrar</button>
            </div>
        </form>
    </div>

    <!-- Theme Custom -->
    <script type="text/javascript" src="js/custom.js"></script>
    <script type="text/javascript" src="js/filesaver.js"></script>

    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
    <!-- <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script> -->

    <script>
        var max_fields = 10; //maximum input boxes allowed
        var wrapper = $("#input_fields_wrap"); //Fields wrapper
        var add_button = $("#add_button"); //Add button ID

        var x = 1; //initlal text box count
        $(add_button).click(function (e) { //on add input button click
            e.preventDefault();
            if (x < max_fields) { //max input box allowed
                x++; //text box increment
                $(wrapper).append(
                    '<div class="form-group row">' +
                    '<input class="form-group col m-1" type="text" name="punt" class="form-control" id="punt' + (x - 1) + '" placeholder="Punt del dia">' +
                    '<input class="form-group col m-1" type="text" name="time" class="form-control" id="time' + (x - 1) + '" placeholder="Temps">' +
                    '<button class="col-1 btn btn-outline-danger my-2" id="remove_field"><i class="fas fa-minus-circle"></i>Eliminar</button></div>'
                ); //add input box
            }
        });

        $(wrapper).on("click", "#remove_field", function (e) { //user click on remove text
            e.preventDefault(); $(this).parent('div').remove(); x--;
        });

        //generar json desde form
        function get() {
            var form = document.getElementById('myForm');
            var array = [];

/*            obj['url'] = document.getElementById('url').value;
            array.push(obj); */

            for (var i = 0; i < form.getElementsByTagName('input').length / 2; i++) {
                let puntname = '#punt' + i;
                let timename = '#time' + i;
                var punt = document.querySelector(puntname);
                var time = document.querySelector(timename);

                let obj = {};
                obj['punt'] = i;
                obj['name'] = punt.value;
                obj['time'] = time.value;

                array.push(obj);
            }
            let jsonString = JSON.stringify(array);
            let json = JSON.parse(jsonString);
            
            console.log(json);

            //guardar com a fitxer
            var blob = new Blob([jsonString],
                { type: "text/plain;charset=utf-8" });
            saveAs(blob, "caca.json");
            
            return false;
        }


    </script>
</body>

</html>